#!/bin/bash
# DEPLOYMENT FINAL A RAILWAY - Ejecuta Esto Paso a Paso

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸš€ DEPLOYMENT A RAILWAY - YOUTUBE TRANSCRIBER PRO"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Paso 1: Verificar cÃ³digo estÃ¡ pusheado
echo "ğŸ“¦ PASO 1: Verificando cÃ³digo..."
git status
echo ""
read -p "Â¿El cÃ³digo estÃ¡ limpio? (y/n): " clean
if [ "$clean" != "y" ]; then
    echo "âŒ Pushea los cambios primero"
    exit 1
fi

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  âš™ï¸  PASO 2: CONFIGURAR RAILWAY"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Ve a: https://railway.app/dashboard"
echo ""
echo "1. Si NO tienes proyecto:"
echo "   - Click 'New Project'"
echo "   - Selecciona 'Deploy from GitHub repo'"
echo "   - Busca: inginddie/youtube-transcriber"
echo "   - Click 'Deploy Now'"
echo ""
echo "2. Si YA tienes proyecto:"
echo "   - Abre tu proyecto existente"
echo "   - Click en tu servicio"
echo ""
read -p "Presiona Enter cuando hayas abierto el proyecto en Railway..."

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸŒ¿ PASO 3: CONFIGURAR BRANCH"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "En Railway:"
echo "1. Click en tu servicio"
echo "2. Ve a: Settings â†’ Source"
echo "3. Branch: Selecciona 'claude/code-review-analysis-pUkeS'"
echo "4. Click 'Save'"
echo ""
read -p "Presiona Enter cuando hayas configurado el branch..."

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸ” PASO 4: VARIABLES DE ENTORNO"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "En Railway, ve a: Variables tab"
echo ""
echo "Agrega estas 6 VARIABLES (Click '+ New Variable' 6 veces):"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "Variable 1:"
echo "  Name:  OPENAI_API_KEY"
echo "  Value: [TU API KEY REAL DE OPENAI]"
echo ""
echo "Variable 2:"
echo "  Name:  REQUIRE_AUTH"
echo "  Value: true"
echo ""
echo "Variable 3:"
echo "  Name:  ACCESS_CODE"
echo "  Value: 83dtfmoj7Grq4UBmtI4vcJYoABo5CTs5H68FNVOvszE"
echo ""
echo "Variable 4:"
echo "  Name:  MAX_TRANSCRIPTIONS_PER_HOUR"
echo "  Value: 3"
echo ""
echo "Variable 5:"
echo "  Name:  MAX_SEARCHES_PER_MINUTE"
echo "  Value: 10"
echo ""
echo "Variable 6:"
echo "  Name:  MAX_CHATS_PER_MINUTE"
echo "  Value: 5"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "âš ï¸  IMPORTANTE:"
echo "   - Reemplaza [TU API KEY REAL DE OPENAI] con tu key real"
echo "   - Copia el ACCESS_CODE exactamente como estÃ¡ arriba"
echo "   - Los nÃºmeros deben ser sin comillas"
echo ""
read -p "Presiona Enter cuando hayas agregado las 6 variables..."

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸ—ï¸  PASO 5: MONITOREAR BUILD"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Railway comenzarÃ¡ a desplegar automÃ¡ticamente."
echo ""
echo "1. Ve a: Deployments tab"
echo "2. Click en el deployment activo"
echo "3. Ve a 'Build Logs' para ver el progreso"
echo ""
echo "DeberÃ­as ver:"
echo "  Step 1/8: FROM python:3.11-slim"
echo "  Step 2/8: RUN apt-get update..."
echo "  ..."
echo "  Step 8/8: CMD [\"python\", \"app_gradio.py\"]"
echo "  Successfully built"
echo ""
echo "Luego en 'Deploy Logs':"
echo "  ğŸ”§ Setting up directories..."
echo "  âœ… Security manager imported successfully"
echo "  ğŸš€ Launching Gradio interface..."
echo "  Running on local URL: http://0.0.0.0:7860"
echo ""
read -p "Presiona Enter cuando el deployment diga 'Success'..."

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸŒ PASO 6: OBTENER URL"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "1. En Railway, ve a: Settings â†’ Domains"
echo "2. Click 'Generate Domain'"
echo "3. Railway generarÃ¡ una URL como:"
echo "   https://youtube-transcriber-production-XXXX.up.railway.app"
echo ""
read -p "Presiona Enter cuando tengas la URL..."

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸ§ª PASO 7: PROBAR LA APLICACIÃ“N"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Ahora vamos a probar que todo funciona:"
echo ""
echo "TEST 1: Abrir la app"
echo "  â†’ Abre la URL de Railway en tu navegador"
echo "  â†’ DeberÃ­as ver: ğŸ¥ YouTube Transcriber Pro"
echo "  â†’ SIN banner rojo (porque REQUIRE_AUTH=true)"
echo ""
read -p "Â¿Ves la aplicaciÃ³n? (y/n): " see_app
echo ""

echo "TEST 2: Verificar autenticaciÃ³n"
echo "  â†’ Ve a la pestaÃ±a 'ğŸ” Login'"
echo "  â†’ DeberÃ­as ver un campo para Access Code"
echo ""
read -p "Â¿Ves la pestaÃ±a de Login? (y/n): " see_login
echo ""

echo "TEST 3: Hacer login"
echo "  â†’ En 'Access Code', ingresa:"
echo "    83dtfmoj7Grq4UBmtI4vcJYoABo5CTs5H68FNVOvszE"
echo "  â†’ Click 'ğŸ”“ Login'"
echo "  â†’ DeberÃ­as ver:"
echo "    âœ… Login Successful!"
echo "    Session ID: ..."
echo ""
read -p "Â¿Login exitoso? (y/n): " login_ok
echo ""

echo "TEST 4: Verificar seguridad activa"
echo "  â†’ Mira la barra superior"
echo "  â†’ DeberÃ­as ver:"
echo "    ğŸŸ¢ Status: Authenticated & Protected âœ…"
echo "    Protection: ğŸ›¡ï¸ ACTIVE"
echo ""
read -p "Â¿Ves protecciÃ³n activa? (y/n): " protection_ok
echo ""

echo "TEST 5: Probar transcripciÃ³n (opcional)"
echo "  â†’ Ve a 'ğŸ“ Transcribe Videos'"
echo "  â†’ Ingresa una URL corta de YouTube"
echo "  â†’ Click 'ğŸš€ Transcribe Videos'"
echo "  â†’ DeberÃ­a empezar a procesar"
echo ""
read -p "Â¿Quieres probar una transcripciÃ³n? (y/n): " test_transcribe

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  âœ… DEPLOYMENT COMPLETADO"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Tu aplicaciÃ³n estÃ¡ desplegada y PROTEGIDA âœ…"
echo ""
echo "ğŸ“‹ INFORMACIÃ“N PARA COMPARTIR:"
echo ""
echo "  URL: [La URL de Railway que generaste]"
echo "  Access Code: 83dtfmoj7Grq4UBmtI4vcJYoABo5CTs5H68FNVOvszE"
echo ""
echo "  Instrucciones para usuarios:"
echo "  1. Abrir URL"
echo "  2. Ir a pestaÃ±a 'ğŸ” Login'"
echo "  3. Ingresar Access Code"
echo "  4. Click Login"
echo "  5. Â¡Listo para transcribir!"
echo ""
echo "ğŸ”’ SEGURIDAD ACTIVA:"
echo "  âœ… Login requerido"
echo "  âœ… Rate limiting activo"
echo "  âœ… Session timeout: 1 hora"
echo "  âœ… LÃ­mites:"
echo "     - 3 transcripciones/hora"
echo "     - 10 bÃºsquedas/minuto"
echo "     - 5 mensajes chat/minuto"
echo ""
echo "ğŸ“Š MONITOREO:"
echo "  - Railway Dashboard â†’ Deployments (ver logs)"
echo "  - Railway Dashboard â†’ Metrics (CPU, memoria)"
echo "  - En la app â†’ Tab 'ğŸ”’ Security' (ver estado)"
echo ""
echo "ğŸ‰ Â¡FELICIDADES! Deployment exitoso."
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
